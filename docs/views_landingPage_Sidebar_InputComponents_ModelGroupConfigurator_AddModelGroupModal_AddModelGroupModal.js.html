

<!DOCTYPE html>
<html lang="en">

<head>
  
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title> views/landingPage/Sidebar/InputComponents/ModelGroupConfigurator/AddModelGroupModal/AddModelGroupModal.js</title>

  <script src="https://cdn.jsdelivr.net/gh/google/code-prettify@master/loader/run_prettify.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="./build/entry.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
  <link href="https://fonts.googleapis.com/css?family=Roboto:100,400,700|Inconsolata,700" rel="stylesheet">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">
  <link type="text/css" rel="stylesheet" href="https://jmblog.github.io/color-themes-for-google-code-prettify/themes/tomorrow-night.min.css">
  <link type="text/css" rel="stylesheet" href="styles/app.min.css">
  <link type="text/css" rel="stylesheet" href="styles/iframe.css">
  <link type="text/css" rel="stylesheet" href="">
  <script async defer src="https://buttons.github.io/buttons.js"></script>

  
</head>



<body class="layout small-header">
    <div id="stickyNavbarOverlay"></div>
    

<div class="top-nav">
    <div class="inner">
        <a id="hamburger" role="button" class="navbar-burger" aria-label="menu" aria-expanded="false">
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
        </a>
        <div class="logo">
            
             
                <a href="index.html">
                    <h1 class="navbar-item">O3as Webapp documentation</h1>
                </a>
            
        </div>
        <div class="menu">
            
            <div class="navigation">
                <a
                    href="index.html"
                    class="link"
                >
                    Documentation
                </a>
                
                
                
            </div>
        </div>
    </div>
</div>
    <div id="main">
        <div
            class="sidebar "
            id="sidebarNav"
        >
            
            <nav>
                
                    <h2><a href="index.html">Documentation</a></h2><div class="category"><h3>Modules</h3><ul><li><a href="module-API.html">API</a></li><li><a href="module-ArrayOperations.html">ArrayOperations</a></li><li><a href="module-Constants.html">Constants</a></li><li><a href="module-CSV.html">CSV</a></li><li><a href="module-Math.html">Math</a></li><li><a href="module-ModelNameConverter.html">ModelNameConverter</a></li><li><a href="module-OptionsFormatter.html">OptionsFormatter</a></li><li><a href="module-PDF.html">PDF</a></li><li><a href="module-TextSearch.html">TextSearch</a></li></ul><h3>Components</h3><ul><li><a href="AddModelGroupModal.html">AddModelGroupModal</a></li><li><a href="App.html">App</a></li><li><a href="CookieConsentModal.html">CookieConsentModal</a></li><li><a href="DiscardChangesModal.html">DiscardChangesModal</a></li><li><a href="DownloadModal.html">DownloadModal</a></li><li><a href="DownloadModal-downloadGraphAsCsv.html">downloadGraphAsCsv</a></li><li><a href="EditModelGroupModal.html">EditModelGroupModal</a></li><li><a href="ErrorMessageModal.html">ErrorMessageModal</a></li><li><a href="Footer.html">Footer</a></li><li><a href="Graph.html">Graph</a></li><li><a href="LandingPage.html">LandingPage</a></li><li><a href="LatitudeBandSelector.html">LatitudeBandSelector</a></li><li><a href="LatitudeBandSelector.CustomLatitudeSelector.html">CustomLatitudeSelector</a></li><li><a href="Logo.html">Logo</a></li><li><a href="ModelGroupCard.html">ModelGroupCard</a></li><li><a href="ModelGroupConfigurator.html">ModelGroupConfigurator</a></li><li><a href="Navbar.html">Navbar</a></li><li><a href="PlotNameField.html">PlotNameField</a></li><li><a href="PlotTypeSelector.html">PlotTypeSelector</a></li><li><a href="ReferenceModelSelector.html">ReferenceModelSelector</a></li><li><a href="ReferenceYearField.html">ReferenceYearField</a></li><li><a href="RegionSelector.html">RegionSelector</a></li><li><a href="SearchBar.html">SearchBar</a></li><li><a href="SeasonCheckBoxGroup.html">SeasonCheckBoxGroup</a></li><li><a href="Section.html">Section</a></li><li><a href="Sidebar.html">Sidebar</a></li><li><a href="TimeCheckBoxGroup.html">TimeCheckBoxGroup</a></li><li><a href="XAxisField.html">XAxisField</a></li><li><a href="YAxisField.html">YAxisField</a></li></ul><h3>Global</h3><ul><li><a href="global.html#apiSlice">apiSlice</a></li><li><a href="global.html#extraReducers">extraReducers</a></li><li><a href="global.html#fetchModels">fetchModels</a></li><li><a href="global.html#fetchPlotData">fetchPlotData</a></li><li><a href="global.html#fetchPlotDataForCurrentModels">fetchPlotDataForCurrentModels</a></li><li><a href="global.html#fetchPlotDataInitiallyPending">fetchPlotDataInitiallyPending</a></li><li><a href="global.html#fetchPlotDataRefetching">fetchPlotDataRefetching</a></li><li><a href="global.html#fetchPlotDataRejected">fetchPlotDataRejected</a></li><li><a href="global.html#fetchPlotDataSuccess">fetchPlotDataSuccess</a></li><li><a href="global.html#fetchPlotTypes">fetchPlotTypes</a></li><li><a href="global.html#generateCacheKey">generateCacheKey</a></li><li><a href="global.html#getAllSelectedModels">getAllSelectedModels</a></li><li><a href="global.html#initialState">initialState</a></li><li><a href="global.html#REQUEST_STATE">REQUEST_STATE</a></li><li><a href="global.html#selectActivePlotData">selectActivePlotData</a></li><li><a href="global.html#selectExistingPlotData">selectExistingPlotData</a></li><li><a href="global.html#updateDataAndDisplaySuggestions">updateDataAndDisplaySuggestions</a></li></ul></div><div class="category"><h2>ModelSlice</h2><h3>Global</h3><ul><li><a href="global.html"></a></li><li><a href="global.html#initialState">initialState</a></li><li><a href="global.html#MODEL_DATA_TEMPLATE">MODEL_DATA_TEMPLATE</a></li><li><a href="global.html#modelsSlice">modelsSlice</a></li><li><a href="global.html#selectAllGroupIds">selectAllGroupIds</a></li><li><a href="global.html#selectAllModelGroups">selectAllModelGroups</a></li><li><a href="global.html#selectModelDataOfGroup">selectModelDataOfGroup</a></li><li><a href="global.html#selectModelsOfGroup">selectModelsOfGroup</a></li><li><a href="global.html#selectNameOfGroup">selectNameOfGroup</a></li><li><a href="global.html#selectStatisticalValueSettingsOfGroup">selectStatisticalValueSettingsOfGroup</a></li><li><a href="global.html#selectVisibilityOfGroup">selectVisibilityOfGroup</a></li></ul></div><div class="category"><h2>plotSlice</h2><h3>Global</h3><ul><li><a href="global.html"></a></li><li><a href="global.html#initialState">initialState</a></li><li><a href="global.html#plotSlice">plotSlice</a></li><li><a href="global.html#selectPlotId">selectPlotId</a></li><li><a href="global.html#selectPlotLocation">selectPlotLocation</a></li><li><a href="global.html#selectPlotMonths">selectPlotMonths</a></li><li><a href="global.html#selectPlotTitle">selectPlotTitle</a></li><li><a href="global.html#selectPlotXRange">selectPlotXRange</a></li><li><a href="global.html#selectPlotYRange">selectPlotYRange</a></li></ul></div><div class="category"><h2>referenceSlice</h2><h3>Global</h3><ul><li><a href="global.html"></a></li><li><a href="global.html#initialState">initialState</a></li><li><a href="global.html#referenceSlice">referenceSlice</a></li><li><a href="global.html#selectIsOffsetApplied">selectIsOffsetApplied</a></li><li><a href="global.html#selectRefModel">selectRefModel</a></li><li><a href="global.html#selectRefYear">selectRefYear</a></li><li><a href="global.html#selectVisibility">selectVisibility</a></li></ul></div>
                
            </nav>
        </div>
        <div class="core" id="main-content-wrapper">
            <div class="content">
                <header class="page-title">
                    <p>Source</p>
                    <h1>views/landingPage/Sidebar/InputComponents/ModelGroupConfigurator/AddModelGroupModal/AddModelGroupModal.js</h1>
                </header>
                



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import React, { useEffect } from "react";
import { setModelsOfModelGroup } from "../../../../../../store/modelsSlice/modelsSlice";
import { useTheme } from '@mui/material/styles';
import { CardContent, Divider, IconButton, Modal, TextField } from '@mui/material';
import { Box } from '@mui/system';
import { Typography } from '@mui/material';
import Grid from '@mui/material/Grid';
import List from '@mui/material/List';
import ListItem from '@mui/material/ListItem';
import ListItemIcon from '@mui/material/ListItemIcon';
import ListItemText from '@mui/material/ListItemText';
import Checkbox from '@mui/material/Checkbox';
import Button from '@mui/material/Button';
import { Card } from '@mui/material';
import CardActions from '@mui/material/CardActions';
import CircularProgress from '@mui/material/CircularProgress';
import CardHeader from '@mui/material/CardHeader';
import Searchbar from "../../../../../../components/Searchbar/Searchbar";
import { convertModelName } from "../../../../../../utils/ModelNameConverter";
import { union, not, intersection } from "../../../../../../utils/arrayOperations";
import CloseIcon from '@mui/icons-material/Close';
import Alert from "@mui/material/Alert";
import PropTypes from 'prop-types'; 
import { useDispatch, useSelector } from "react-redux";
import { fetchPlotDataForCurrentModels, REQUEST_STATE } from "../../../../../../services/API/apiSlice";
import { selectNameOfGroup, selectModelDataOfGroup } from "../../../../../../store/modelsSlice/modelsSlice";
import DoneIcon from "@mui/icons-material/Done";


/**
 * opens a modal where the user can add a new model group
 * @component
 * @param {Object} props specified in propTypes
 * @returns {JSX.Element} a jsx containing a modal with a transfer list with all available models
 */
function AddModelGroupModal(props) {
    
    const isEditMode = 'modelGroupId' in props;

    /**
     * the label in the card heading
     */
    const addModelLabel = isEditMode ? "Edit Model Group Members" : "Add Model Group";
    
    const dispatch = useDispatch();

    const modelListRequestedData = useSelector(state => state.api.models);

    let isLoading = true;
    let allModels = [];
    if (modelListRequestedData.status === REQUEST_STATE.idle
        || modelListRequestedData.status === REQUEST_STATE.loading) {
            isLoading = true;
    }
    else if (modelListRequestedData.status === REQUEST_STATE.success) {
        allModels = modelListRequestedData.data;
        isLoading = false;
    }

    const modelGroupId = isEditMode ? props.modelGroupId : -1;

    /**
     * Array containing all currently checked models
     */
    const [checked, setChecked] = React.useState([]);
    /**
     * Array containing all models, that are currently plotted in the right transfer list
     * -> models that should eventually be added
     */
    const storeRight = Object.keys(useSelector(state => selectModelDataOfGroup(state, modelGroupId)));
    const [right, setRight] = React.useState(storeRight);
    /**
     * Array containing all models that should currently be visibile
     * because of the search function those might differ from all models
     */
    const [visible, setVisible] = React.useState([]);
    /**
     * The currently enetered group name
     */
    const storeGroupName = useSelector(state => selectNameOfGroup(state, modelGroupId));
    const [groupName, setGroupName] = React.useState(storeGroupName);
    const [errorMessage, setErrorMessage] = React.useState('');
    const theme = useTheme();

    useEffect(() => {
        if (modelListRequestedData.status === REQUEST_STATE.error) {
            props.reportError("API not responding: " + modelListRequestedData.error);
        }
        if (modelListRequestedData.status === REQUEST_STATE.success) {
            setVisible(modelListRequestedData.data);
        }
    }, [allModels]);

    

    /**
     * Returns how many models in the provided array are currently checked
     * @param {Array} models models to check
     * @returns the number of checked models in models
     */
    const numberOfChecked = (models) => intersection(checked, models).length;
    /**
     * All models that are currently on the left side
     * -> all models that are not currently on the right side are on the left side
     */
    const left = not(allModels, right);
    /**
     * An array containing all models that are currently on the left side and are checked
     */
    const leftChecked = intersection(checked, left);
    /**
     * An array containing all models that are currently on the right side and are checked
     */
    const rightChecked = intersection(checked, right);
    /**
     * An array containing all models that are currently on the left side and are visible
     */
    const leftVisible = intersection(visible, left);
    /**
     * An array containing all models that are currently on the right side and are visible
     */
    const rightVisible = intersection(visible, right);

    /**
     * Toggles one element
     * i.e. checks the element if it had not been checked before
     * and unchecks it if it has been checked
     * @param {String} value the id of the model that has been clicked
     */
    const handleChangeElement = (value) => () => {
        const currentIndex = checked.indexOf(value);
        const newChecked = [...checked];
    
        if (currentIndex === -1) {
          newChecked.push(value);
        } else {
          newChecked.splice(currentIndex, 1);
        }
        setChecked(newChecked);
    };

    /**
     * Toggles whole list of elements
     * i.e. checks all if one element in items has not been checked before
     * and unchecks all if all elements in items have been checked
     * @param {Array} items array containing model ids to check / uncheck
     */
    const handleToggleAll = (items) => () => {
        if (numberOfChecked(items) === items.length) {
            setChecked(not(checked, items));
        } else {
            setChecked(union(checked, items));
        }
    };

    /**
     * moves all checked models from the right list to the left and unchecks them
     * -> appends all leftChecked models to the right array and removes them from the checked array
     */
    const handleCheckedRight = () => {
        setRight(right.concat(leftChecked));
        setChecked(not(checked, leftChecked));
    };

    /**
     * moves all checked models from the left to right and unchecks them
     * -> removes all rightChecked models from the right and checked array
     */
    const handleCheckedLeft = () => {
        setRight(not(right, rightChecked));
        setChecked(not(checked, rightChecked));
    };
    
    const addOrEditGroup = () => {
        if (groupName === '') {
            setErrorMessage("Please provide a model group name");
            return;
        }
        if (right.length === 0) {
            setErrorMessage("Please provide a list of models for this group");
            return;
        }
        dispatch(setModelsOfModelGroup({groupId: props.modelGroupId, groupName: groupName, modelList: right}));
        dispatch(fetchPlotDataForCurrentModels());
        setGroupName("");
        setVisible(allModels);
        setChecked([]);
        setRight([]);
        props.onClose();
    }

    /**
     * sets the currently visible models by a provided array of indices
     * ! overwrites old visibilities
     * @param {Array} visibleModels array of models that should be currently visible
     */
    const setCurrentlyVisibleModels = (visibleModels) => {
        setVisible(visibleModels);
    }

    /**
     * renders a custom transfer list component with provided lists
     * @param {Array} models array of modelIDs that belong to the list
     * @param {Array} modelsChecked array of modelIDs that are currently checked
     * @param {Array} modelsVisible array of modelIDS that are currently visible
     * @returns {JSX.Element} a Card containing a custom transfer list and a warning if checked models are currently not visible
     */
    const customList = (models, modelsChecked, modelsVisible) => {
        const modelsCheckedInvisible = intersection(not(models, modelsVisible), modelsChecked);
        return (
            &lt;Card sx={{backgroundColor: theme.palette.background.paper}}>
                &lt;CardHeader
                    sx={{ px: 2, py: 1 }}
                    avatar={
                        &lt;Checkbox
                            onClick={handleToggleAll(modelsVisible)}
                            checked={numberOfChecked(modelsVisible) === modelsVisible.length &amp;&amp; modelsVisible.length !== 0}
                            indeterminate={
                                numberOfChecked(modelsVisible) !== modelsVisible.length &amp;&amp; numberOfChecked(modelsVisible) !== 0
                            }
                            disabled={modelsVisible.length === 0}
                            inputProps={{
                                'aria-label': 'all items selected',
                            }}
                        />
                    }
                    title={`${numberOfChecked(modelsVisible)}/${modelsVisible.length} selected`}
                />
                &lt;Divider />
                &lt;List
                    sx={{
                        width: "100%",
                        height: 230,
                        bgcolor: 'background.paper',
                        overflow: 'auto',
                    }}
                    dense
                    component="div"
                    role="list"
                >
                    {modelsVisible.map((modelId, idx) => {
                        const labelId = `transfer-list-all-item-${modelId}-label`;
                        let model = convertModelName(modelId);
                            return (
                                &lt;ListItem
                                    key={idx}
                                    role="listitem"
                                    button
                                    onClick={handleChangeElement(modelId)}
                                >
                                &lt;ListItemIcon>
                                    &lt;Checkbox
                                        checked={checked.indexOf(modelId) !== -1}
                                        tabIndex={-1}
                                        disableRipple
                                        inputProps={{
                                            'aria-labelledby': labelId,
                                        }}
                                        data-testid={`AddModelGroupModal-transfer-list-item-${labelId}-checkbox`}
                                    />
                                &lt;/ListItemIcon>
                                &lt;ListItemText id={labelId} primary={model.name} secondary={`Institute: ${model.institute}\nProject: ${model.project}`} />
                                &lt;/ListItem>
                            );
                    })}
                &lt;/List>
                    {
                        modelsCheckedInvisible
                        &amp;&amp;
                        modelsCheckedInvisible.length > 0 
                        &amp;&amp;
                        &lt;Alert severity="warning">
                            Currently {modelsCheckedInvisible.length} hidden model{modelsCheckedInvisible.length > 1 ? 's are' : ' is'} checked.
                        &lt;/Alert>
                    }
            &lt;/Card>
        );
    }   

    const style = {
        position: 'absolute',
        top: '50%',
        left: '50%',
        transform: 'translate(-50%, -50%)',
        width: '90%',
        height: '75%',
        boxShadow: 24,
        overflow: "auto",
        bgcolor: theme.palette.background.default,
        minHeight: "75%",
        maxHeight: "100vh",
        p: 4,
      };

    /**
     * updates the current group name
     * @param {event} event the event that called this function
     */
    const updateGroupName = (event) => {
        setGroupName(event.target.value);
    }

    /**
     * @todo open a "discard changes?" popup here
     */
    const closeWithChanges = () => {
        if(isEditMode) {
            setGroupName(storeGroupName);
            setVisible(allModels);
            setChecked([]);
            setRight(storeRight);
        } else {
            setGroupName("");
            setVisible(allModels);
            setChecked([]);
            setRight([]);
        }
        
        props.onClose();
    }

    return (
        &lt;Modal
            open={props.isOpen}
            onClose={closeWithChanges}
            aria-labelledby="modal-modal-title"
            aria-describedby="modal-modal-description"
            data-testid="AddModelGroupModal-modal-wrapper"
        >   
            &lt;Card sx={style}>
                &lt;CardHeader
                    title={addModelLabel}
                    action={
                        &lt;IconButton onClick={closeWithChanges} aria-label="close" data-testid="addModelGroupModal-close-button">
                            &lt;CloseIcon />
                        &lt;/IconButton>
                    }
                />
                &lt;CardContent>
                    &lt;Grid container alignItems="center" justifyContent="center" style={{marginBottom: '2em'}}>
                        &lt;TextField
                            defaultValue={groupName}
                            helperText="The name will only appear in the legend of the exported plot."
                            variant="standard"
                            onBlur={updateGroupName}
                            sx={{marginBottom: '0.5em', marginLeft: '0.5em'}}
                            placeholder="Your group"
                        />
                    &lt;/Grid>
                    &lt;Box id="modal-modal-description" sx={{ mt: 2 }}>
                        &lt;Searchbar inputArray={allModels} foundIndicesCallback={setCurrentlyVisibleModels} shouldReturnValues={true} />
                        &lt;Grid container spacing={2} justifyContent="center" alignItems="center" sx={{ marginTop: '0.5em' }}>
                            &lt;Grid item sm={5} xs={12}>
                                &lt;Typography>All Available Models&lt;/Typography>
                                {
                                    isLoading ? 
                                        &lt;CircularProgress data-testid="AddModelGroupModal-spinner-left" />
                                    :
                                        customList(left, leftChecked, leftVisible)
                                }
                            &lt;/Grid>
                            &lt;Grid item sm={2} xs={12}>
                                &lt;Grid container direction="column" alignItems="center">
                                    &lt;Button
                                        sx={{ my: 0.5 }}
                                        variant="outlined"
                                        size="small"
                                        onClick={handleCheckedRight}
                                        disabled={leftChecked.length === 0}
                                        aria-label="move selected right"
                                        data-testid="AddModelGroupModal-button-move-allChecked-right"
                                    >
                                        &amp;gt;
                                    &lt;/Button>
                                    &lt;Button
                                        sx={{ my: 0.5 }}
                                        variant="outlined"
                                        size="small"
                                        onClick={handleCheckedLeft}
                                        disabled={rightChecked.length === 0}
                                        aria-label="move selected left"
                                        data-testid="AddModelGroupModal-button-move-allChecked-left"
                                    >
                                        &amp;lt;
                                    &lt;/Button>
                                &lt;/Grid>
                            &lt;/Grid>
                            &lt;Grid item sm={5} xs={12}>
                                &lt;Typography>Models in {groupName ? groupName : "your group"}&lt;/Typography>
                                {
                                    isLoading ? 
                                        &lt;CircularProgress data-testid="AddModelGroupModal-spinner-right" />
                                    :
                                        customList(right, rightChecked, rightVisible)
                                }
                            &lt;/Grid>
                        &lt;/Grid>
                    &lt;/Box>
                    {errorMessage &amp;&amp; &lt;Alert severity="error" sx={{marginTop: '2em'}}>{errorMessage}&lt;/Alert>}
                &lt;/CardContent>
                &lt;CardActions sx={{justifyContent: "flex-end", marginTop: "2%"}}>
                    &lt;Button onClick={addOrEditGroup} variant="contained">{'modelGroupId' in props? "Save Changes" : "Add group"}&lt;/Button>
                &lt;/CardActions>
            &lt;/Card>
        &lt;/Modal>
    );
}

AddModelGroupModal.propTypes = {
    /**
     * function for error handling
     */
    reportError: PropTypes.func.isRequired,
    /**
     * function to call if modal should be closed
     */
    onClose: PropTypes.func.isRequired,
    /**
     * boolean whether the modal should be visible
     */
    isOpen: PropTypes.bool.isRequired,
    /**
     * string identifying the model group,
     * if this model should be used to edit an existing model group
     */
    modelGroupId: PropTypes.number
}


export default AddModelGroupModal;</code></pre>
        </article>
    </section>




            </div>
            
            <footer class="footer">
                <div class="content has-text-centered">
                    <p>Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.10</a></p>
                    <p class="sidebar-created-by">
                        <a href="https://github.com/SoftwareBrothers/better-docs" target="_blank">BetterDocs theme</a> provided with <i class="fas fa-heart"></i> by
                        <a href="http://softwarebrothers.co" target="_blank">SoftwareBrothers - JavaScript Development Agency</a>
                    </p>
                </div>
            </footer>
            
        </div>
        <div id="side-nav" class="side-nav">
        </div>
    </div>
<script src="scripts/app.min.js"></script>
<script>PR.prettyPrint();</script>
<script src="scripts/linenumber.js"> </script>


</body>
</html>
